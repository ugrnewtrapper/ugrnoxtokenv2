<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Teste de Compra - Wallet v12</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

  <h2>Teste de Compra – Wallet v12</h2>

  <!-- FixtureId manual para teste -->
  <label>
    Fixture ID:
    <input type="number" id="fixtureId" placeholder="Ex: 123456" />
  </label>

  <br><br>

  <!-- Botões -->
  <button id="btnConnect">1️⃣ Conectar Carteira</button>
  <button id="btnPay">2️⃣ Pagar Análise</button>
  <button id="btnUnlock">3️⃣ Liberar Análise</button>

  <pre id="log"></pre>

  <!-- Wallet -->
  <script src="./walletv12.js"></script>

  <script>
    const log = (msg) => {
      const el = document.getElementById("log");
      el.textContent += msg + "\n";
    };

    document.getElementById("btnConnect").onclick = async () => {
      try {
        const wallet = await walletv12.connectWallet();
        log("Carteira conectada: " + wallet);
      } catch (err) {
        log("Erro conectar: " + err.message);
      }
    };

    document.getElementById("btnPay").onclick = async () => {
      try {
        const res = await walletv12.payForAnalysis();
        log("Pagamento enviado!");
        log("TxHash: " + res.txHash);
      } catch (err) {
        log("Erro pagamento: " + err.message);
      }
    };

    document.getElementById("btnUnlock").onclick = async () => {
      try {
        const fixtureId = document.getElementById("fixtureId").value;
        const res = await walletv12.unlockAnalysis({ fixtureId });
        log("Resposta backend:");
        log(JSON.stringify(res, null, 2));
      } catch (err) {
        log("Erro unlock: " + err.message);
      }
    };
  </script>

</body>
</html>
