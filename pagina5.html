<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Teste Backend V12</title>
</head>
<body>

<input id="apiKey" placeholder="API Key"><br><br>
<input type="date" id="date"><br><br>

<button id="load">Carregar partidas</button><br><br>

<select id="fixtures"></select><br><br>

<button id="analyze">Analisar</button>

<pre id="out"></pre>

<script type="module">
  import { WalletV12 } from "./money/walletv12.js";
  import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.13.2/+esm";

  // ðŸ”´ OBRIGATÃ“RIO: endereÃ§o real do seu Worker
  const BACKEND_BASE = "https://backendv12.srrimas2017.workers.dev";

  const out = document.getElementById("out");
  const log = x => out.textContent = JSON.stringify(x, null, 2);

  const wallet = new WalletV12();

  document.getElementById("load").onclick = async () => {
    const res = await fetch(`${BACKEND_BASE}/api/partidas`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        apiKey: apiKey.value,
        date: date.value
      })
    });

    const json = await res.json();
    fixtures.innerHTML = "";

    json.data.forEach(f => {
      const o = document.createElement("option");
      o.value = f.fixture.id;
      o.textContent = `${f.teams.home.name} x ${f.teams.away.name}`;
      fixtures.appendChild(o);
    });

    log("Partidas carregadas");
  };

  document.getElementById("analyze").onclick = async () => {
    const payment = await wallet.pay();

    const res = await fetch(`${BACKEND_BASE}/api/analisar`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        apiKey: apiKey.value,
        fixtureId: Number(fixtures.value),
        txHash: payment.txHash
      })
    });

    log(await res.json());
  };
</script>

</body>
</html>
