<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Teste Real ‚Äî Wallet + Analysis</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: #eaeaea;
      padding: 20px;
    }

    button {
      padding: 12px 16px;
      margin: 8px 0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #2563eb;
      color: white;
      font-weight: bold;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    pre {
      background: #111;
      padding: 12px;
      border-radius: 6px;
      max-height: 350px;
      overflow: auto;
      font-size: 12px;
    }
  </style>
</head>

<body>

<h2>üí≥ Teste REAL ‚Äî Pagamento + Libera√ß√£o de An√°lise</h2>

<button id="btnPay">Pagar e Liberar An√°lise</button>

<pre id="log"></pre>

<script type="module">
import { payAndAnalyze } from "./money/walletv12.js";

/* =============================
   CONFIGURA√á√ïES
============================= */
const API_KEY = "44154acf83f7568c7b0e75e10676a2dd";
const BACKEND_ANALYSIS = "https://backendv12.srrimas2017.workers.dev/analysis";

/*
  FixtureIds v√°lidos de teste.
  (Pode trocar depois por reais)
*/
const FIXTURES_TESTE = [
  215662,
  215663,
  215664,
  215665,
  215666
];

/* =============================
   UI
============================= */
const logEl = document.getElementById("log");
const log = (msg) => {
  logEl.textContent += msg + "\n";
  logEl.scrollTop = logEl.scrollHeight;
};

/* =============================
   EVENTO PRINCIPAL
============================= */
document.getElementById("btnPay").onclick = async () => {
  logEl.textContent = "";

  try {
    const fixtureId =
      FIXTURES_TESTE[Math.floor(Math.random() * FIXTURES_TESTE.length)];

    log("üéØ Fixture sorteado:");
    log(String(fixtureId));

    log("üí≥ Iniciando pagamento REAL on-chain...");
    log("‚õìÔ∏è MetaMask ser√° solicitada");

    const result = await payAndAnalyze({
      apiKey: API_KEY,
      fixtureId,
      backendUrl: BACKEND_ANALYSIS
    });

    log("‚úÖ PAGAMENTO CONFIRMADO");
    log("üìä AN√ÅLISE LIBERADA:");
    log(JSON.stringify(result, null, 2));

  } catch (err) {
    log("‚ùå ERRO NO FLUXO:");
    log(err?.message || err);
    console.error(err);
  }
};
</script>

</body>
</html>
