<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NOX Premium â€¢ AnÃ¡lises</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*,*::before,*::after{box-sizing:border-box}
body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:#020617;
color:#e6f1f5;
padding:20px 10px 40px;
}
.container{
max-width:520px;
margin:auto;
background:#020f1a;
border-radius:20px;
padding:22px;
box-shadow:0 25px 60px rgba(0,0,0,.6);
}
button{
width:100%;
height:46px;
margin-top:10px;
border-radius:14px;
font-weight:700;
cursor:pointer;
}
button.secondary{
background:transparent;
border:1px solid #14b8a6;
color:#14b8a6;
}
.match{
padding:8px 10px;
border-radius:10px;
cursor:pointer;
font-size:13.5px;
}
.match.selected{
background:#14b8a6;
color:#001312;
font-weight:700;
}
.status{
margin-top:14px;
padding:12px;
border-radius:14px;
background:#03131f;
border:1px solid #0ea5a5;
font-size:13px;
text-align:center;
}
</style>
</head>

<body>
<div class="container">

<h2>NOX Premium</h2>

<div id="paymentStatus" class="status">
ðŸ”’ Acesso Premium bloqueado.
</div>

<label>API Key</label>
<input id="apikey" placeholder="Digite sua API Key">

<label>Data</label>
<input id="date" type="date">

<button id="loadBtn" class="secondary">ðŸ“… Carregar Partidas</button>

<div id="competitions"></div>

<button id="payBtn" class="secondary">ðŸ’³ Efetuar Pagamento</button>
<button id="analyzeBtn" style="display:none">ðŸ“Š Analisar Partida</button>

<div id="results"></div>

</div>

<script>
/* ======================================================
   HARDENING PASSIVO (SEM QUEBRA)
====================================================== */
(() => {
  const warn = () => console.warn("âš ï¸ Ambiente monitorado.");
  document.addEventListener("keydown", e => {
    if (e.key === "F12") warn();
  });
  const c = console.clear;
  console.clear = () => { warn(); c.call(console); };
})();

/* ======================================================
   ESTADO
====================================================== */
const BACKEND_LIST = "https://backendnoxv2.srrimas2017.workers.dev";
let loading = false;
let analyzing = false;

/* ======================================================
   PARTIDAS
====================================================== */
loadBtn.onclick = async () => {
  if (loading) return;
  loading = true;

  try{
    const apiKey = apikey.value.trim();
    const date = document.getElementById("date").value;

    if (!apiKey || !date) {
      alert("Informe API Key e Data.");
      return;
    }

    const res = await fetch(BACKEND_LIST,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ apiKey, date })
    });

    if (!res.ok) throw new Error("Backend indisponÃ­vel");

    const data = await res.json();
    competitions.innerHTML = "";

    if (!Array.isArray(data?.competitions)) return;

    data.competitions.forEach(c=>{
      if (!Array.isArray(c.matches)) return;

      const block = document.createElement("div");
      block.innerHTML = `<h3>${c.league}</h3>`;

      c.matches.forEach(m=>{
        if (!Number.isInteger(m.fixtureId)) return;

        const el = document.createElement("div");
        el.className = "match";
        el.dataset.fixture = m.fixtureId;
        el.textContent = `${m.time} ${m.home} x ${m.away}`;
        el.onclick = () => window.selectMatch(el);
        block.appendChild(el);
      });

      competitions.appendChild(block);
    });

  } catch (e) {
    alert("Erro ao carregar partidas.");
  } finally {
    loading = false;
  }
};

/* ======================================================
   PAGAMENTO CONFIRMADO (CÃ“DIGO 2)
====================================================== */
window.addEventListener("nox-payment-ok", () => {
  paymentStatus.innerText =
    "âœ… Pagamento confirmado. Selecione a partida.";
  analyzeBtn.style.display = "block";
});

/* ======================================================
   ANÃLISE (CÃ“DIGO 3)
====================================================== */
analyzeBtn.onclick = () => {
  if (analyzing) return;
  analyzing = true;

  try{
    if (
      typeof window.analyzeMatch !== "function" ||
      !Number.isInteger(window.selectedFixture) ||
      !apikey.value.trim()
    ){
      alert("Estado invÃ¡lido para anÃ¡lise.");
      return;
    }

    paymentStatus.innerText = "ðŸ“Š Gerando anÃ¡lise Premium...";
    window.analyzeMatch();

  } finally {
    setTimeout(() => analyzing = false, 2000);
  }
};
</script>

<script type="module" src="money/walletv12.js"></script>
<script type="module" src="statistics/statistics.js"></script>

</body>
</html>
