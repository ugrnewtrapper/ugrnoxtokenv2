<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NOX Football Analytics ‚öΩ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, #0a2cff, #0d6efd);
  color: #fff;
  text-align: center;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.logo {
  max-width: 180px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

input, button {
  padding: 12px;
  margin: 8px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

input { width: 260px; }

button {
  background: #00d4ff;
  color: #003;
  font-weight: bold;
  cursor: pointer;
}

.section {
  margin-top: 25px;
  background: rgba(255,255,255,0.1);
  padding: 15px;
  border-radius: 12px;
}

.competition h3 {
  cursor: pointer;
  color: #00ffff;
}

.match {
  margin-left: 15px;
  cursor: pointer;
  padding: 6px;
}

.match:hover {
  background: rgba(255,255,255,0.15);
}

.selected {
  background: rgba(0,255,255,0.3);
}

.footer {
  margin-top: 40px;
  font-size: 14px;
  opacity: 0.8;
}
</style>
</head>

<body>
<div class="container">

<img src="images/logo.png" class="logo">

<h1>NOX Football Analytics ‚öΩüìä</h1>

<div class="section">
  <input id="apiKey" placeholder="üîë API Key">
  <input type="date" id="date"><br>
  <button onclick="loadCompetitions()">üìÖ Carregar Competi√ß√µes</button>
</div>

<div id="competitions" class="section"></div>

<div class="section">
  <button onclick="analyzeMatch()">üìä Analisar Partida</button>
</div>

<div id="result" class="section"></div>

<div class="footer">Vers√£o 1.0 Pro üöÄ</div>
</div>

<script>
const BACKEND = "https://backendnoxv2.srrimas2017.workers.dev";
let selectedFixture = null;
let openedCompetition = null;

async function loadCompetitions() {
  selectedFixture = null;
  openedCompetition = null;

  const apiKey = apiKeyInput();
  const date = dateInput();
  if (!apiKey || !date) return alert("Informe API Key e data");

  const box = document.getElementById("competitions");
  box.innerHTML = "‚è≥ Carregando...";

  const res = await fetch(BACKEND, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ apiKey, date })
  });

  const data = await res.json();
  if (!data.competitions?.length) {
    box.innerHTML = "‚ùå Nenhuma competi√ß√£o encontrada";
    return;
  }

  box.innerHTML = data.competitions.map((c,i)=>`
    <div class="competition">
      <h3 onclick="toggleComp(${i})">üèÜ ${c.league} (${c.country})</h3>
      <div class="matches" id="comp-${i}" style="display:none">
        ${c.matches.map(m=>`
          <div class="match"
            data-fixture="${m.fixtureId}"
            onclick="selectMatch(this)">
            ‚è∞ ${m.time} - ${m.home} x ${m.away}
          </div>`).join("")}
      </div>
    </div>
  `).join("");
}

function toggleComp(idx) {
  const el = document.getElementById(`comp-${idx}`);

  // Se clicar na mesma competi√ß√£o aberta ‚Üí fecha
  if (openedCompetition === idx) {
    el.style.display = "none";
    openedCompetition = null;
    return;
  }

  // Fecha todas
  document.querySelectorAll(".matches").forEach(m => {
    m.style.display = "none";
  });

  // Abre apenas a selecionada
  el.style.display = "block";
  openedCompetition = idx;
      }
function selectMatch(el) {
  document.querySelectorAll(".match").forEach(m=>m.classList.remove("selected"));
  el.classList.add("selected");
  selectedFixture = Number(el.dataset.fixture);
}

async function analyzeMatch() {
  if (!selectedFixture) return alert("Selecione uma partida");

  const res = await fetch(BACKEND,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      apiKey: apiKeyInput(),
      date: dateInput(),
      fixtureId: selectedFixture
    })
  });

  const data = await res.json();
  if (data.error) return result.innerHTML = "‚ùå "+data.error;

  result.innerHTML = `
    <h3>${data.home} x ${data.away}</h3>
    <p>H2H: ${data.h2hGames}</p>
    <ul>${Object.entries(data.means)
      .map(([k,v])=>`<li>${k}: <strong>${v}</strong></li>`).join("")}
    </ul>`;
}

const apiKeyInput = ()=>document.getElementById("apiKey").value.trim();
const dateInput = ()=>document.getElementById("date").value;
</script>

</body>
</html>
