<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NOX Football Analytics | Análise Estatística Profissional de Futebol</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg-main: #0f1216;
  --bg-card: #151a21;
  --primary: #1f6feb;
  --primary-dark: #164fb3;
  --text-main: #e6e6e6;
  --text-muted: #a0a7b4;
  --border-soft: rgba(255,255,255,0.08);
}

body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: var(--bg-main);
  color: var(--text-main);
  text-align: center;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.top-back {
  text-align: left;
  margin-bottom: 10px;
}

.top-back a {
  color: var(--primary);
  text-decoration: none;
  font-weight: bold;
}

.top-back a:hover {
  color: var(--primary-dark);
}

.logo {
  max-width: 180px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.04); }
  100% { transform: scale(1); }
}

h1 {
  margin-top: 12px;
  color: var(--text-main);
}

p {
  color: var(--text-muted);
  line-height: 1.5;
}

input, button {
  padding: 12px;
  margin: 8px;
  border-radius: 8px;
  border: 1px solid var(--border-soft);
  font-size: 16px;
  background: var(--bg-card);
  color: var(--text-main);
}

input {
  width: 260px;
}

button {
  background: var(--primary);
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
}

button:hover {
  background: var(--primary-dark);
  transform: scale(1.04);
}

.section {
  margin-top: 25px;
  background: var(--bg-card);
  padding: 16px;
  border-radius: 14px;
  border: 1px solid var(--border-soft);
}

.competition {
  margin-top: 10px;
  text-align: left;
}

.competition h3 {
  cursor: pointer;
  color: var(--primary);
  margin-bottom: 6px;
}

.match {
  margin-left: 15px;
  cursor: pointer;
  padding: 6px;
  border-radius: 6px;
}

.match:hover {
  background: rgba(255,255,255,0.05);
}

.selected {
  background: rgba(31,111,235,0.25);
}

.footer {
  margin-top: 40px;
  font-size: 14px;
  color: var(--text-muted);
}

a {
  color: var(--primary);
  text-decoration: none;
  font-weight: bold;
}

a:hover {
  color: var(--primary-dark);
}
</style>
</head>

<body>
<div class="container">

<div class="top-back">
  <a href="index.html">← Voltar</a>
</div>

<img src="images/logo2.png" class="logo" alt="NOX Logo">

<h1>NOX Football Analytics</h1>

<p>
Plataforma profissional de análise estatística de futebol baseada em dados reais.
Os cálculos utilizam médias históricas, confrontos diretos (H2H) e indicadores probabilísticos,
extraídos em tempo real da API-Football.
</p>

<p style="font-size:14px; margin-top:8px;">
Cada partida envolve variáveis imprevisíveis. Os dados auxiliam a tomada de decisão,
mas não eliminam riscos. Utilize as informações com responsabilidade.
</p>

<div class="section">
  <input type="text" id="apiKey" placeholder="Sua API Key">
  <input type="date" id="date">
  <br>
  <button onclick="loadCompetitions()">Carregar Competições</button>
</div>

<div id="competitions" class="section"></div>

<div class="section">
  <button onclick="analyzeMatch()">Analisar Partida</button>
</div>

<div id="result" class="section"></div>

<div class="section">
  <a href="https://www.api-football.com/" target="_blank">
    Criar conta na API-Football
  </a>
  <br><br>
  <a href="images/TUTO.pdf" target="_blank">
    Guia rápido de utilização da API
  </a>
</div>

<div class="footer">Versão 3.0 ULTRA</div>

</div>

<script>
const BACKEND = "https://backendnoxv2.srrimas2017.workers.dev";
let selectedFixture = null;

async function loadCompetitions() {
  const apiKey = document.getElementById("apiKey").value.trim();
  const date = document.getElementById("date").value;

  if (!apiKey || !date) {
    alert("Informe a API Key e a data.");
    return;
  }

  const box = document.getElementById("competitions");
  box.innerHTML = "Carregando competições...";

  const res = await fetch(BACKEND, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ apiKey, date })
  });

  const data = await res.json();

  if (!Array.isArray(data.competitions) || !data.competitions.length) {
    box.innerHTML = "Nenhuma competição encontrada.";
    return;
  }

  let html = "";
  data.competitions.forEach((comp, idx) => {
    html += `
      <div class="competition">
        <h3 onclick="toggleComp(${idx}, event)">${comp.league} (${comp.country})</h3>
        <div class="matches" id="comp-${idx}">
    `;
    comp.matches.forEach(m => {
      html += `
        <div class="match"
             data-fixture="${m.fixtureId}"
             onclick="selectMatch(event, this)">
          ${m.time} - ${m.home} x ${m.away}
        </div>
      `;
    });
    html += `</div></div>`;
  });

  box.innerHTML = html;
}

function toggleComp(idx, event) {
  event.stopPropagation();
  const el = document.getElementById(`comp-${idx}`);
  el.style.display = el.style.display === "none" ? "block" : "none";
}

function selectMatch(event, el) {
  event.stopPropagation();

  document.querySelectorAll(".match").forEach(m =>
    m.classList.remove("selected")
  );

  el.classList.add("selected");
  selectedFixture = el.dataset.fixture;

  document.getElementById("result").innerHTML =
    `<h3>Partida selecionada</h3><p>${el.innerText}</p>`;

  document.querySelectorAll(".matches").forEach(m => {
    m.style.display = "none";
  });

  el.parentElement.style.display = "block";
}

async function analyzeMatch() {
  if (!selectedFixture) {
    alert("Selecione uma partida.");
    return;
  }

  const apiKey = document.getElementById("apiKey").value.trim();
  const date = document.getElementById("date").value;

  if (!apiKey || !date) {
    alert("Informe a API Key e a data.");
    return;
  }

  const result = document.getElementById("result");
  result.innerHTML = "Analisando dados estatísticos...";

  const res = await fetch(BACKEND, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      apiKey,
      date,
      fixtureId: Number(selectedFixture)
    })
  });

  const data = await res.json();

  if (data.error) {
    result.innerHTML = data.error;
    return;
  }

  let html = `
    <h3>${data.home} x ${data.away}</h3>
    <p>Jogos analisados (H2H): ${data.h2hGames}</p>
    <ul>
  `;

  Object.entries(data.means).forEach(([k, v]) => {
    html += `<li>${k}: <strong>${v}</strong></li>`;
  });

  html += "</ul>";
  result.innerHTML = html;
}
</script>
</body>
</html>
