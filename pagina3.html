<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NOX Football Analytics ‚öΩ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, #0a2cff, #0d6efd);
  color: #fff;
  text-align: center;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.logo {
  max-width: 180px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

h1 { margin-top: 10px; }
p { opacity: 0.9; }

input, button {
  padding: 12px;
  margin: 8px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

input { width: 260px; }

button {
  background: #00d4ff;
  color: #003;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}

button:hover {
  background: #00ffff;
  transform: scale(1.05);
}

.section {
  margin-top: 25px;
  background: rgba(255,255,255,0.1);
  padding: 15px;
  border-radius: 12px;
}

.competition {
  margin-top: 10px;
  text-align: left;
}

.competition h3 {
  cursor: pointer;
  color: #00ffff;
}

.match {
  margin-left: 15px;
  cursor: pointer;
  padding: 5px;
}

.match:hover {
  background: rgba(255,255,255,0.15);
}

.selected {
  background: rgba(0,255,255,0.3);
}

.footer {
  margin-top: 40px;
  font-size: 14px;
  opacity: 0.8;
}

a {
  color: #00ffff;
  text-decoration: none;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="container">

<img src="images/logo.png" class="logo" alt="NOX Logo">

<h1>NOX Football Analytics ‚öΩüìä</h1>

<p>
Plataforma profissional para an√°lise de partidas de futebol.<br>
Conectada em tempo real com a <strong>API-Football</strong>.
</p>

<div class="section">
  <input type="text" id="apiKey" placeholder="üîë Sua API Key">
  <input type="date" id="date">
  <br>
  <button onclick="loadCompetitions()">üìÖ Carregar Competi√ß√µes</button>
</div>

<div id="competitions" class="section"></div>

<div class="section">
  <button onclick="analyzeMatch()">üìä Analisar Partida</button>
</div>

<div id="result" class="section"></div>

<div class="section">
  <button onclick="location.href='index.html'">üè† P√°gina Inicial</button><br><br>

  <a href="https://www.api-football.com/" target="_blank">
    ‚û°Ô∏è Criar API Football
  </a>
  <br><br>

  <a href="images/TUTO.pdf" target="_blank">
    üìò Guia R√°pido da API Football
  </a>
</div>

<div class="footer">Vers√£o 1.2 Pro üöÄ</div>
</div>

<script>
const BACKEND = "https://backendnoxv2.srrimas2017.workers.dev";
let selectedFixture = null;

async function loadCompetitions() {
  const apiKey = document.getElementById("apiKey").value.trim();
  const date = document.getElementById("date").value;

  if (!apiKey || !date) {
    alert("‚ö†Ô∏è Informe API Key e data");
    return;
  }

  const box = document.getElementById("competitions");
  box.innerHTML = "‚è≥ Carregando competi√ß√µes...";

  const res = await fetch(BACKEND, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ apiKey, date })
  });

  const data = await res.json();

  if (!Array.isArray(data.competitions) || !data.competitions.length) {
    box.innerHTML = "‚ùå Nenhuma competi√ß√£o encontrada";
    return;
  }

  let html = "";
  data.competitions.forEach((comp, idx) => {
    html += `
      <div class="competition">
        <h3 onclick="toggleComp(${idx}, event)">üèÜ ${comp.league} (${comp.country})</h3>
        <div class="matches" id="comp-${idx}">
    `;
    comp.matches.forEach(m => {
      html += `
        <div class="match"
             data-fixture="${m.fixtureId}"
             onclick="selectMatch(event, this)">
          ‚è∞ ${m.time} - ${m.home} x ${m.away}
        </div>
      `;
    });
    html += `</div></div>`;
  });

  box.innerHTML = html;
}

function toggleComp(idx, event) {
  event.stopPropagation();
  const el = document.getElementById(`comp-${idx}`);
  el.style.display = el.style.display === "none" ? "block" : "none";
}

function selectMatch(event, el) {
  event.stopPropagation();

  document.querySelectorAll(".match").forEach(m =>
    m.classList.remove("selected")
  );

  el.classList.add("selected");
  selectedFixture = el.dataset.fixture;

  document.getElementById("result").innerHTML = `<h3>üìå Partida selecionada:</h3><p>${el.innerText}</p>`;

  document.querySelectorAll(".matches").forEach(m => {
    m.style.display = "none";
  });

  el.parentElement.style.display = "block";
}

async function analyzeMatch() {
  if (!selectedFixture) {
    alert("‚ö†Ô∏è Selecione uma partida");
    return;
  }

  const apiKey = document.getElementById("apiKey").value.trim();
  const date = document.getElementById("date").value;

  if (!apiKey || !date) {
    alert("‚ö†Ô∏è Informe API Key e data");
    return;
  }

  const result = document.getElementById("result");
  result.innerHTML = "üìä Analisando...";

  const res = await fetch(BACKEND, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      apiKey,
      date,
      fixtureId: Number(selectedFixture)
    })
  });

  const data = await res.json();

  if (data.error) {
    result.innerHTML = "‚ùå " + data.error;
    return;
  }

  let html = `
    <h3>${data.home} x ${data.away}</h3>
    <p>Jogos analisados (H2H): ${data.h2hGames}</p>
    <ul>
  `;

  Object.entries(data.means).forEach(([k, v]) => {
    html += `<li>${k}: <strong>${v}</strong></li>`;
  });

  html += "</ul>";
  result.innerHTML = html;
}
</script>
</body>
</html>
